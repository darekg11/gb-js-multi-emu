<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="GB Js Multi Emu - Website playground">
        <meta name="author" content="Dariusz GÃ³rak (https://www.github.com/darekg11)">

        <title>GB JS Multi Emu - Website playground</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
        <link rel="stylesheet" href="./styles//index.css">
    </head>
    <body>
        <script src="scripts/runner.ts"></script>
        <section class="section">
            <div class="container">
                <div class="columns is-mobile is-centered">
                    <div class="column is-centered is-flex" style="justify-content: center;">
                        <canvas class="emulator-window" id="emulator_window" width="160" height="144"></canvas>
                    </div>
                  </div>
            </div>
        </section>
        <section class="section">
            <div class="container">
                <button onclick="window.singleStep()">STEP</button>
            </div>
        </section>
        <section class="section">
            <div class="container">
                <div>
                    <h4>DEBUG INFO:</h4>
                    <h3 id="debug_pc">PC: </h3>
                    <h3 id="debug_current_instruction">Current Instruction (HEX): </h3>
                    <h3 id="debug_reg_a">A: </h3>
                    <h3 id="debug_reg_b">B: </h3>
                    <h3 id="debug_reg_c">C: </h3>
                    <h3 id="debug_reg_d">D: </h3>
                    <h3 id="debug_reg_e">E: </h3>
                    <h3 id="debug_reg_f">F: </h3>
                    <h3 id="debug_reg_h">H: </h3>
                    <h3 id="debug_reg_l">L: </h3>
                    <h3 id="debug_reg_hl">HL: </h3>
                    <h3 id="debug_reg_sp">SP: </h3>
                    <h3 id="debug_zero_flag">Zero Flag state: </h3>
                    <h3 id="debug_subtraction_flag">Subtraction flag state: </h3>
                    <h3 id="debug_half_carry_flag">Half carry flag state: </h3>
                    <h3 id="debug_carry_flag">Carry flag state: </h3>
                    <h3 id="debug_memory_value_index">MEMORY: </h3>
                </div>
            </div>
        </section>
    </body>
    <script>
        const runner = window.globalThis.runner;
        const pc_reg_info_element = document.getElementById("debug_pc");
        const current_instruction_info_element = document.getElementById("debug_current_instruction");
        const reg_a_info_element = document.getElementById("debug_reg_a");
        const reg_b_info_element = document.getElementById("debug_reg_b");
        const reg_c_info_element = document.getElementById("debug_reg_c");
        const reg_d_info_element = document.getElementById("debug_reg_d");
        const reg_e_info_element = document.getElementById("debug_reg_e");
        const reg_f_info_element = document.getElementById("debug_reg_f");
        const reg_h_info_element = document.getElementById("debug_reg_h");
        const reg_l_info_element = document.getElementById("debug_reg_l");
        const reg_hl_info_element = document.getElementById("debug_reg_hl");
        const reg_sp_info_element = document.getElementById("debug_reg_sp");
        const reg_memory_info_element = document.getElementById("debug_memory_value_index");
        const zero_flag_info_element = document.getElementById("debug_zero_flag");
        const subtraction_flag_info_element = document.getElementById("debug_subtraction_flag");
        const half_carry_flag_info_element = document.getElementById("debug_half_carry_flag");
        const carry_flag_info_element = document.getElementById("debug_carry_flag");

        const singleStep = () => {
            runner.tick();
            getDebugInfo();
        }

        const getDebugInfo = (memoryIndex = 0) => {
            const debugInfo = runner.getDebugInfo();
            pc_reg_info_element.innerHTML = `PC: ${debugInfo.PC}`;
            current_instruction_info_element.innerHTML = `Current Instruction (HEX): 0x${runner.getMemoryValue(debugInfo.PC).toString(16).toUpperCase()}`;
            reg_a_info_element.innerHTML = `A: ${debugInfo.A}`;
            reg_b_info_element.innerHTML = `B: ${debugInfo.B}`;
            reg_c_info_element.innerHTML = `C: ${debugInfo.C}`;
            reg_d_info_element.innerHTML = `D: ${debugInfo.D}`;
            reg_e_info_element.innerHTML = `E: ${debugInfo.E}`;
            reg_f_info_element.innerHTML = `F: ${debugInfo.F}`;
            reg_h_info_element.innerHTML = `H: ${debugInfo.H}`;
            reg_l_info_element.innerHTML = `L: ${debugInfo.L}`;
            reg_hl_info_element.innerHTML = `HL: ${debugInfo.HL}`;
            reg_sp_info_element.innerHTML = `SP: ${debugInfo.SP}`;
            reg_memory_info_element.innerHTML = `Memory Index: ${memoryIndex}, value: ${runner.getMemoryValue(memoryIndex)}`;
            zero_flag_info_element.innerHTML = `Zero Flag state: ${Number(debugInfo.ZERO_FLAG)}`;
            subtraction_flag_info_element.innerHTML = `Subtraction Flag state: ${Number(debugInfo.SUBTRACTION_FLAG)}`;
            half_carry_flag_info_element.innerHTML = `Half Carry Flag state: ${Number(debugInfo.HALF_CARRY_FLAG)}`;
            carry_flag_info_element.innerHTML = `Carry Flag state: ${Number(debugInfo.CARRY_FLAG)}`;
        }

        getDebugInfo();
    </script>
</html>